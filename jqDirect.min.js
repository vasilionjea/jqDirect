/* Name: jqDirect
 * Description: Gets Google Map directions from one address to another. Having a map on the page is totally optional.
 * Author: Billy Onjea (github.com/vasilionjea/jqDirect)
 * License: Same as jQuery
 */
(function(d){function g(a,b){this.$el=d(a);this.settings=d.extend({},k,b);this.directions_list=document.createElement("div");this.map=this.$directions_output=null;this.markers=[]}var k={from:"",to:"",output:""},h=new google.maps.LatLngBounds,j=new google.maps.Geocoder,l=new google.maps.DirectionsService,f=new google.maps.DirectionsRenderer;d.extend(g.prototype,{_init:function(){var a=this;a.settings.to&&(this.map=this._createMap(),this._geocode_address(a.settings.to,function(b){a.addMarker(b)})); return a},_createMap:function(){var a=document.getElementById(this.$el.prop("id")),b=new google.maps.Map(a,{zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP});google.maps.event.addListenerOnce(b,"zoom_changed",function(){b.setZoom(15)});return b},_geocode_address:function(a,b){a&&b&&j.geocode({address:a},function(a,e){e===google.maps.GeocoderStatus.OK&&b(a[0].geometry.location)})},_get_geocoded_address:function(a,b){a&&b&&j.geocode({latLng:a},function(a,e){e===google.maps.GeocoderStatus.OK&&b(a[0].formatted_address)})}, addMarker:function(a){var b=this,c;a&&("string"==typeof a?b._geocode_address(a,function(a){b.addMarker(a)}):(c=new google.maps.Marker({map:b.map,position:a}),h.extend(a),b.map.fitBounds(h),b.markers.push(c)))},calcRoute:function(a){var b=this,c=b.$directions_output=a.output;c.hide();l.route({origin:a.from,destination:a.to||b.settings.to,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(a,d){"OK"==d&&(f.setMap(b.map),f.setDirections(a),f.setPanel(b.directions_list),a.routes[0].copyrights+= " - jqDirect",c.html(b.directions_list).fadeIn(300))})},print:function(){var a=d(document.body).find("#print-frame");a.length&&a.remove();var b=document.createElement("iframe"),c;b.src="";b.id="print-frame";b.width="0";b.height="0";b.scrolling="no";b.border=0;a='<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"><title>Print Directions</title>';a+="<style>";a+="/* Google direction overrides */";a+=".adp-directions { width:100%; }";a+=".adp-substep { border-top:1px solid #f3f3f3; }";a+=".adp-placemark { background:none repeat scroll 0 0 transparent; border:none; }"; a+="</style>";a+="</head>";a+="<body>";a+=this.$directions_output.html();a+=this.$el.wrap("<div />").parent().html();a+="</body></html>";this.$el.unwrap("<div />");document.body.appendChild(b);c=b.contentWindow;b=b.contentDocument||c.document;b.open();b.write(a);b.close();d(b).find("#"+this.$el.prop("id")).css({width:"100%",height:"340px"});c.focus();window.setTimeout(function(){c.print()},13)}});d.fn.jqDirect=function(a,b){return this.each(function(){var c=d(this),e=c.data("jqdirect");e||(e=new g(this, a),c.data("jqdirect",e._init()));if("string"==typeof a&&!/_init|_createMap|_geocode_address|_get_geocoded_address/.test(a))e[a](b)})}})(jQuery);