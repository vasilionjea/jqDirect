/**
 * Name: jqDirect
 * Description: Gets Google Map directions from one address to another. Having a map on the page is totally optional.
 * Author: Billy Onjea 
 * License: Same as jQuery
 */
(function($){var defaults={from:"",to:"",output:""};var LatLngBounds=new google.maps.LatLngBounds,Geocoder=new google.maps.Geocoder,DirectionsService=new google.maps.DirectionsService,DirectionsRenderer=new google.maps.DirectionsRenderer;function jqDirect(el,options){this.$el=$(el);this.settings=$.extend({},defaults,options);this.directions_list=document.createElement("div");this.$directions_output=null;this.map=null;this.markers=[]}$.extend(jqDirect.prototype,{_init:function(){var self=this;if(self.settings.to){this.map=
this._createMap();this._geocode_address(self.settings.to,function(geocoded_location){self.addMarker(geocoded_location)})}return self},_createMap:function(){var map_canvas=document.getElementById(this.$el.prop("id")),map=new google.maps.Map(map_canvas,{zoom:13,mapTypeId:google.maps.MapTypeId["ROADMAP"]});google.maps.event.addListenerOnce(map,"zoom_changed",function(){map.setZoom(15)});return map},_geocode_address:function(str_address,callback){if(!str_address||!callback)return;Geocoder.geocode({"address":str_address},
function(results,status){if(status===google.maps.GeocoderStatus.OK)callback(results[0].geometry.location)})},_get_geocoded_address:function(geocoded_location,callback){if(!geocoded_location||!callback)return;Geocoder.geocode({"latLng":geocoded_location},function(results,status){if(status===google.maps.GeocoderStatus.OK)callback(results[0].formatted_address)})},addMarker:function(geocoded_location){var self=this,marker,str_location;if(!geocoded_location)return;if(typeof geocoded_location=="string"){str_location=
geocoded_location;self._geocode_address(str_location,function(geocoded_location){self.addMarker(geocoded_location)});return}marker=new google.maps.Marker({map:self.map,position:geocoded_location});LatLngBounds.extend(geocoded_location);self.map.fitBounds(LatLngBounds);self.markers.push(marker)},calcRoute:function(destination){var self=this,request;var $directions_output=self.$directions_output=destination.output;$directions_output.hide();request={origin:destination.from,destination:destination.to||
self.settings.to,travelMode:google.maps.DirectionsTravelMode.DRIVING};DirectionsService.route(request,function(result,status){if(status=="OK"){DirectionsRenderer.setMap(self.map);DirectionsRenderer.setDirections(result);DirectionsRenderer.setPanel(self.directions_list);result.routes[0].copyrights+=" - jqDirect";$directions_output.html(self.directions_list).fadeIn(300)}})},print:function(){var self=this,$body=$(document.body),$oldFrame=$body.find("#print-frame");if($oldFrame.length)$oldFrame.remove();
var iframe=document.createElement("iframe"),ihtml,i_window,i_document;iframe.src="";iframe.id="print-frame";iframe.width="0";iframe.height="0";iframe.scrolling="no";iframe.border=0;ihtml='<!DOCTYPE html> <html lang="en">';ihtml+='<head> <meta charset="utf-8">';ihtml+="<title>Print Directions</title>";ihtml+="<style>";ihtml+="/* Google direction overrides */";ihtml+=".adp-directions { width:100%; }";ihtml+=".adp-substep { border-top:1px solid #f3f3f3; }";ihtml+=".adp-placemark { background:none repeat scroll 0 0 transparent; border:none; }";
ihtml+="</style>";ihtml+="</head>";ihtml+="<body>";ihtml+=self.$directions_output.html();ihtml+=self.$el.wrap("<div />").parent().html();ihtml+="</body></html>";self.$el.unwrap("<div />");document.body.appendChild(iframe);i_window=iframe.contentWindow;i_document=iframe.contentDocument||i_window.document;i_document.open();i_document.write(ihtml);i_document.close();$(i_document).find("#"+self.$el.prop("id")).css({width:"100%",height:"340px"});i_window.focus();window.setTimeout(function(){i_window.print()},
13)}});$.fn.jqDirect=function(options,args){return this.each(function(){var $this=$(this),instance=$this.data("jqdirect");if(!instance){instance=new jqDirect(this,options);$this.data("jqdirect",instance._init())}if(typeof options=="string"&&!/^_/.test(options))instance[options](args)})}})(jQuery);